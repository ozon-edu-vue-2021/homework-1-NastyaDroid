<!DOCTYPE html>
<html lang="ru">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>The Reactivity</title>
    <link rel="stylesheet" href="./style/index.css">
    <link rel="icon" href="./images/vue-logo.svg">
    <script src="https://cdn.jsdelivr.net/npm/vue@2/dist/vue.js"></script>
</head>

<body>
    <section class="app vue-app">
        <h1>VUE</h1>
        <h2>How much will?</h2>
        <p>{{counter}} + {{step}}</p>
        <p><strong>Result: {{sum}}</strong></p>
        <p><strong>Произведение: {{product}}</strong></p>
        <div class="math">
            Counter:
            <button class="button minus" v-on:click="decrementCounterHandler">-1</button>
            <button class="button plus" v-on:click="incrementCounterHandler">+1</button>
        </div>
        <div class="math">
            Step:
            <button class="button minus" v-on:click="decrementStepHandler">-2</button>
            <button class="button plus" v-on:click="incrementStepHandler">+2</button>
        </div>
    </section>
    <hr>
    <section class="app js-app">
        <h1>JS</h1>
        <h2>How much will?</h2>
        <p><span class="counter"></span> + <span class="step"></span></p>
        <p><strong>Сумма: <span class="sum"></span></strong></p>
        <p><strong>Произведение: <span class="multiply"></span></strong></p>
        <div class="math common">
            Counter:
            <button data-action="counterMinus" class="button minus">-1</button>
            <button data-action="counterPlus" class="button plus">+1</button>
        <div class="math">
            Step:
            <button data-action="stepMinus"class="button minus">-2</button>
            <button data-action="stepPlus" class="button plus">+2</button>
        </div>
        </div>
    </section>
    <script>
        const $vue = new Vue({
            el: '.vue-app',
            data: {
                counter: 1,
                step: 2
            },
            methods: {
                incrementCounterHandler() {
                        this.counter++;
                    },
                    decrementCounterHandler() {
                        this.counter--;
                    },
                    incrementStepHandler() {
                        this.step += 2;
                    },
                    decrementStepHandler() {
                        this.step -= 2;
                    }
                },
                computed: {
                    sum() {
                        return this.counter + this.step;
                    },
                    product() {
                        return this.counter * this.step;
                    }
                }
        })
    </script>
    <script>
        var buttonCounterMinus = document.querySelector('.js-app [data-action="counterMinus"]');
            var buttonCounterPlus = document.querySelector('.js-app [data-action="counterPlus"]');
            var buttonStepMinus = document.querySelector('.js-app [data-action="stepMinus]');
            var buttonStepPlus = document.querySelector('.js-app [data-action="stepPlus"]');
            var sumEl = document.querySelector('.js-app .sum');
            var productEl = document.querySelector('.js-app .multiply');
            var counterEl = document.querySelector('.js-app .counter');
            var stepEl = document.querySelector('.js-app .step');
            var divMath = document.querySelector('.js-app .common');

            class Result {
                constructor(elem) {
                    this._elem = elem;
                    elem.onclick = this.onClick.bind(this);
                }

            counterPlus() {
                data.counter++;
                counterEl.textContent = data.counter;
            }
            counterMinus() {
                data.counter--;
                counterEl.textContent = data.counter;
            }
            stepPlus() {
                data.step += 2;
                stepEl.textContent = data.step;
            }
            stepMinus() {
                data.step -= 2;
                stepEl.textContent = data.step;
            }
            onClick(event) {
                let action = event.target.dataset.action;
                if(action) {
                    this[action]();
                }
            };
        }
            class Mediator {
                constructor() {
                    this.subscribers = []; 
                }
                depend() {
                    if (target && !this.subscribers.includes(target)) {
                        this.subscribers.push(target)
                    }
                }
                notify() {
                    this.subscribers.forEach(sub => sub())
                }
            }
            var divCounter = new Result(divMath);
            var data = {
            counter: 1,
            step: 2
            };
            
            Object.keys(data).forEach(key => {
                var internalValue = data[key];
                var mediator = new Mediator();
            Object.defineProperty(data, key, {
                get() {
                    console.log(mediator.subscribers)
                    mediator.depend();
                return internalValue;
                 },
                 set(newVal) {
                     internalValue = newVal;
                     mediator.notify();
                 } 
                 } );
            })

            function observer(myFunc) {
                target = myFunc;
                target();
                target = null;
            }

            observer(() => {
                var sum = data.counter + data.step;
                sumEl.textContent = sum;
                var product = data.counter * data.step;
                productEl.textContent = product;
            });
            counterEl.textContent = data.counter;    
            stepEl.textContent = data.step;
    </script>
</body>

</html>
